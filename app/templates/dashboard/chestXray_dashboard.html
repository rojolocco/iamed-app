{% extends '/dashboard/base_dashboard.html' %}

<title>{% block title %}IA.Med ChestXray Dashboard Page{% endblock %}</title>

{% block container %}
<!-- ============================================================== -->
<!-- Bread crumb and right sidebar toggle -->
<!-- ============================================================== -->
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-5 align-self-center">
            <h4 class="page-title">ChestXray</h4>
        </div>
        <div class="col-7 align-self-center">
            <div class="d-flex align-items-center justify-content-end">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="#">Inicio</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ChestXray</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<!-- ============================================================== -->
<!-- End Bread crumb and right sidebar toggle -->
<!-- ============================================================== -->

<div class="container-fluid">
    <!-- ============================================================== -->
    <!-- Email campaign chart -->
    <!-- ============================================================== -->
    <div class="container-fluid">
        <div class="row justify-content-around">
            <div class="col-md-5 text-center">
                <h1>RADIOGRAFIA DE TORAX</h1>
                <form method="POST" action="{{ url_for('chestXray_pred') }}" enctype="multipart/form-data">
                    <div class="form-group">
                        <div class="container-fluid">
                            {% if  main %}
                            <img id="image1" src="../../static/dashboard/images/healthcare-animation.gif"
                                class="img-fluid w-100" alt="ChestXray">
                            <label for="">Imagenes permitidas (*.png, *.jpg, *.jpeg, *.dcm)</label>
                            {% else %}
                            <img id="image1" src="../../static/uploads/chestXray/{{ filename }}" class="img-fluid w-100"
                                alt="ChestXray">
                            <label for="">Imagenes permitidas (*.png, *.jpg, *.jpeg, *.dcm)</label>
                            {% endif %}
                        </div>
                        <br>
                        <div class="custom-file">
                            <input id="file1" class="custom-file-input" type="file" name="image">
                            <label for="file1" class="custom-file-label" id="file1-label"
                                style="display: block; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; width: 100%;">Seleccionar
                                imagen...</label>
                        </div>
                    </div>
                    <button class="btn btn-success" type="submit">ANALIZAR</button>
                </form>
            </div>
            <div class="col-md-7">
                {% if main %}
                <div class="container-fluid">
                    <h1 class="pb-2">¿Que es ChestXray?</h1>
                <p style="font-size:120%;" class="text-justify"> ChestXray es una aplicación que hace parte de IA.Med con la cual se pueden 
                hacer análisis tempranos sobre radiografías de tórax. Con ChestXray se pueden hacer detección temprana de por lo menos 10 
                patologías presentes en el tórax humano, como por ejemplo Atelectasia, Consolidación, Neumonía, Neumotórax, entre otras. 
                Esta aplicación tiene la capacidad de detectar simultáneamente estas patologías y diagnosticar cual es la probabilidad que 
                el paciente padezca alguna o mas de una de estas enfermedades en menos de un minuto. ChestXray más que una aplicación de 
                diagnostico es una herramienta para la toma de decisiones con la cual los profesionales de la salud podrán tomar decisiones 
                acertadas y a tiempo.</p>
                </div>
                <div class="container-fluid py-3">
                    <img src="static/dashboard/images/chestxray_2.jpg" alt="IA.Med Logo" style="width: 100%" />
                </div>
                <div class="container-fluid">
                    <h2 class="mt-2">¿Como empezar?</h2>
                    <p style="font-size:120%;" class="text-justify">Utilizar ChestXray es muy fácil. Selecciona una radiografía de tórax 
                        que este en el formato adecuado y luego dale clic en el botón de analizar. ChestXray analizará la imagen y te mostrara 
                        las probabilidades que el paciente tenga alguna de las 10 patologías y también diagnosticara cuales de esas patologías 
                        se debería poner más atención y hacer un estudio más profundo.</p>
                </div>
                <h2 class="text-center pt-4">ChestXray es la mejor herramienta en <br><img src="static/home/img/apple-icon_2.png" alt="iamed"
                        style="width: 5%">
                    <span style="color: rgb(107, 206, 7);">DIAGNÓSTICOS CON RADIOGRAFÍAS DE TÓRAX!</span> </h2>
                {% else %}
                <h3 class="text-center pb-3">RESULTADOS</h3>
                {% for i in outputs %}
                <div class="row justify-content-around">
                    <div class="col-md-3">
                        <a href="{{ url_for('patologias') }}" class="pt-1" style="font-size: 18px; color:black">{{ classes[loop.index - 1] }}</a>
                    </div>
                    <div class="col-md-2">
                        <p class="pt-1" style="font-size: 15px;">Probabilidad: {{ (100*i)|round(1) }}</p>
                    </div>
                    {% if i <= 0.5*tresholds[classes[loop.index - 1]] %}
                    {% set barcolor = 'dark' %}
                    {% elif i <= tresholds[classes[loop.index - 1]] %}
                    {% set barcolor = 'primary' %}
                    {% elif i<= 0.5*(1-tresholds[classes[loop.index - 1]]) + tresholds[classes[loop.index - 1]]  %}
                    {% set barcolor = 'info' %}
                    {% else %}
                    {% set barcolor = 'success' %}
                    {% endif %}
                    <div class="col-md-4">
                        <div class="progress pt-1" style="height: 25px;">
                            <div class="progress-bar progress-bar-striped bg-{{ barcolor }} progress-bar-animated" 
                            role="progressbar" style="width: {{ i*100 }}%" aria-valuenow="{{ i*100 }}"
                                aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <p class="pt-1" style="font-size: 15px;">Umbral: {{ (100*tresholds[classes[loop.index - 1]])|round(1) }}</p>
                    </div>
                </div>
                {% endfor %}
                <hr>
                <h3 class="text-center py-2">POSIBLES PATOLOGIAS</h3>
                <p style="font-size: 20px;">{{ pat_preds }}</p>
                {% endif %}
                </div>
            </div>
        </div>

        <!-- ============================================================== -->
        <!-- Email campaign chart -->
        <!-- ============================================================== -->

    </div>

    {% endblock %}

    {% block script %}
    <script>
        $('#file1').on('change', function () {
            //get the file name
            var fileName = $(this).val();
            //replace the "Choose a file" label
            $(this).next('.custom-file-label').html(fileName);
        });
    </script>
    <script>
        $('#file1').on('change', function () {
            var files = !!this.files ? this.files : [];
            if (!files.length || !window.FileReader) return; // no file selected, or no FileReader support

            if (/^image/.test(files[0].type)) { // only image file
                var reader = new FileReader(); // instance of the FileReader
                reader.readAsDataURL(files[0]); // read the local file

                reader.onloadend = function () { // set image data as background of div
                    $('#image1').attr('src', reader.result).removeClass('default')
                }
            }
        });
    </script>
    {% endblock %}